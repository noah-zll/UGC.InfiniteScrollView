# InfiniteScrollView 多选功能使用说明

## 功能概述

InfiniteScrollView 支持完整的多选功能，包括：
- 单选模式
- 多选模式
- 键盘快捷键支持
- 程序化选择控制

## 基础设置

### 1. 启用选中状态
```csharp
scrollView.EnableSelectionState = true;  // 启用选中功能
```

### 2. 启用多选模式
```csharp
scrollView.AllowMultipleSelection = true;  // 启用多选
```

## 用户交互方式

### 单选模式 (AllowMultipleSelection = false)
- **普通点击**: 选中点击的项目，取消之前的选择

### 多选模式 (AllowMultipleSelection = true)
- **普通点击**: 选中点击的项目，取消之前的选择（单选行为）
- **Ctrl + 点击**: 切换点击项目的选中状态（保持其他选择）
- **Shift + 点击**: 从上次选中的项目到当前点击项目进行范围选择

## 程序化控制

### 选择操作
```csharp
// 选中单个项目（会根据多选设置决定是否清除之前选择）
scrollView.SelectItem(index);

// 选中多个项目
scrollView.SelectItems(0, 2, 4);

// 切换项目选中状态
scrollView.stateManager.ToggleSelection(index);

// 范围选择
scrollView.stateManager.SelectRange(startIndex, endIndex);

// 清空所有选择
scrollView.ClearSelection();
```

### 查询选中状态
```csharp
// 获取所有选中的索引
var selectedIndices = scrollView.SelectedIndices;

// 检查特定项目是否被选中
bool isSelected = scrollView.stateManager.IsItemSelected(index);

// 获取选中数量
int count = scrollView.SelectedIndices.Count;
```

## 事件监听

```csharp
// 监听选择变化事件
scrollView.stateManager.OnSelectionChanged += (index, isSelected) => {
    Debug.Log($"项目 {index} 选中状态变为: {isSelected}");
};
```

## 调试和测试

### 使用调试组件
1. 将 `MultiSelectionDebugger` 组件添加到场景中
2. 设置 `scrollView` 引用
3. 运行游戏，使用GUI界面进行测试

### 快捷键测试
- **F1**: 执行基础多选测试
- **F2**: 执行键盘多选测试

### 常见问题排查

1. **多选不工作**
   - 确认 `EnableSelectionState = true`
   - 确认 `AllowMultipleSelection = true`
   - 确认正确使用 Ctrl 或 Shift 键

2. **选中状态不显示**
   - 确认列表项实现了 `IScrollViewItem` 接口
   - 确认 `OnItemSelected` 方法正确更新了视觉状态

3. **键盘快捷键不响应**
   - 确认游戏窗口有焦点
   - 确认没有其他UI元素拦截输入

## 最佳实践

1. **性能考虑**: 大量选择时，避免频繁的UI更新
2. **用户体验**: 提供清晰的视觉反馈显示选中状态
3. **键盘支持**: 考虑添加全选(Ctrl+A)、反选等快捷键
4. **移动端适配**: 移动端可能需要不同的多选交互方式

## 示例代码

```csharp
public class ScrollViewExample : MonoBehaviour
{
    public InfiniteScrollView scrollView;
    
    void Start()
    {
        // 启用多选功能
        scrollView.EnableSelectionState = true;
        scrollView.AllowMultipleSelection = true;
        
        // 监听选择变化
        scrollView.stateManager.OnSelectionChanged += OnSelectionChanged;
        
        // 初始选择
        scrollView.SelectItems(0, 2, 4);
    }
    
    void OnSelectionChanged(int index, bool isSelected)
    {
        Debug.Log($"项目 {index} {(isSelected ? "被选中" : "取消选中")}");
        Debug.Log($"当前选中: [{string.Join(", ", scrollView.SelectedIndices)}]");
    }
    
    void Update()
    {
        // Ctrl+A 全选
        if (Input.GetKey(KeyCode.LeftControl) && Input.GetKeyDown(KeyCode.A))
        {
            scrollView.stateManager.SelectAll();
        }
        
        // Escape 清空选择
        if (Input.GetKeyDown(KeyCode.Escape))
        {
            scrollView.ClearSelection();
        }
    }
}
```